状态模式

状态模式是一种非同寻常的优秀模式，它也许是解决某些需求场景的最好方法

状态模式的关键是区分事务内部的状态，事务内部的状态分改变往往会带来事务行为的改变，把事务的每种状态分装成单独的类，与这个状态有关的行为都被封装在这个类的内部

使用状态模式的好处：
1、可以使每一种状态和它对应的行为之间的关系局部化，这些行为被分散和封装在各自对应的状态类之中，便于阅读和管理代码

2、状态之间的切换被分布在状态类内部，使得无需编写过多的 if， else, 条件分支语言来控制状态之间的切换

状态模式的定义：允许一个对象在其内部状态改变时改变它的行为，对象看起来似乎修改了它的类

即：第一部分意思：将状态封装成独立的类，并将请求委托给当前的状态对象，当对象的内部状态改变时，会带来不同的行为变换

第二部分意思：从客户的角度来看，我们使用的对象，在不同的状态下具有截然不同的行为，这个对象看起来是从不同的类中实例化而来的，但是实际上是使用了委托的效果

状态模式的应用 ———— 微云上传文件

文件在不同的状态下，点击按钮会发生什么行为：

1、文件在扫描状态中，是不能进行任何操作的。既不能暂停也不能删除文件，只能等待扫描完成
扫描完成之后，根据文件的 md5 值判断，若确认该文件已经存在于服务器，则直接跳到上传完成状态；
如果该文件的大小超过允许上传的最大值，或者该文件已经损坏，则跳往上传失败状态，剩下的情况才跳往上传中的状态

2、上传过程中可以点击暂停按钮来暂停上传，暂停后点击同一个按钮会继续上传

3、扫描和上传过程中，点击删除按钮无效，只有暂停、上传完成、上传失败之后，才能删除文件

状态模式的优缺点

优点：
1、状态模式定义了状态与行为之间的关系，并将它们封装在一个类里面。通过增加新的状态类，很容易增加新的状态和转换

2、避免Context无限膨胀，状态切换的逻辑被分布在状态类中，也去掉了Context中原本过多的条件分支

3、用对象代替字符串来记录当前状态，使得状态的切换一目了然

4、Context 中的请求动作和状态类中封装的行为可以非常容易的独立变化而不互相影响

缺点：
会在系统中定义许多状态类

状态模式与策略模式的关系

相同点：
都有一个上下文，一些策略或者状态类，上下文把请求委托给这些类来执行

不同点：
策略模式中，各个策略类之间是平等又平行的，它们之间没有任何联系，所以客户必须熟知这些策略类的作用，以便客户可以随时主动切换算法

状态模式中，状态和状态对应的行为早已被封装好，状态之间的切换早被规定完成，“改变行为” 发生在状态模式内部，客户并不需要了解这些细节

